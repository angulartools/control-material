// This file contains the `_computeAriaAccessibleName` function, which computes what the *expected*
// ARIA accessible name would be for a given element. Implements a subset of ARIA specification
// [Accessible Name and Description Computation 1.2](https://www.w3.org/TR/accname-1.2/).
//
// Specification accname-1.2 can be summarized by returning the result of the first method
// available.
//
//  1. `aria-labelledby` attribute
//     ```
//       <!-- example using aria-labelledby-->
//       <label id='label-id'>Start Date</label>
//       <input aria-labelledby='label-id'/>
//     ```
//  2. `aria-label` attribute (e.g. `<input aria-label="Departure"/>`)
//  3. Label with `for`/`id`
//     ```
//       <!-- example using for/id -->
//       <label for="current-node">Label</label>
//       <input id="current-node"/>
//     ```
//  4. `placeholder` attribute (e.g. `<input placeholder="06/03/1990"/>`)
//  5. `title` attribute (e.g. `<input title="Check-In"/>`)
//  6. text content
//     ```
//       <!-- example using text content -->
//       <label for="current-node"><span>Departure</span> Date</label>
//       <input id="current-node"/>
//     ```
/**
 * Computes the *expected* ARIA accessible name for argument element based on [accname-1.2
 * specification](https://www.w3.org/TR/accname-1.2/). Implements a subset of accname-1.2,
 * and should only be used for the Datepicker's specific use case.
 *
 * Intended use:
 * This is not a general use implementation. Only implements the parts of accname-1.2 that are
 * required for the Datepicker's specific use case. This function is not intended for any other
 * use.
 *
 * Limitations:
 *  - Only covers the needs of `matStartDate` and `matEndDate`. Does not support other use cases.
 *  - See NOTES's in implementation for specific details on what parts of the accname-1.2
 *  specification are not implemented.
 *
 *  @param element {HTMLInputElement} native &lt;input/&gt; element of `matStartDate` or
 *  `matEndDate` component. Corresponds to the 'Root Element' from accname-1.2
 *
 *  @return expected ARIA accessible name of argument &lt;input/&gt;
 */
export function _computeAriaAccessibleName(element) {
    return _computeAriaAccessibleNameInternal(element, true);
}
/**
 * Determine if argument node is an Element based on `nodeType` property. This function is safe to
 * use with server-side rendering.
 */
function ssrSafeIsElement(node) {
    return node.nodeType === Node.ELEMENT_NODE;
}
/**
 * Determine if argument node is an HTMLInputElement based on `nodeName` property. This funciton is
 * safe to use with server-side rendering.
 */
function ssrSafeIsHTMLInputElement(node) {
    return node.nodeName === 'INPUT';
}
/**
 * Determine if argument node is an HTMLTextAreaElement based on `nodeName` property. This
 * funciton is safe to use with server-side rendering.
 */
function ssrSafeIsHTMLTextAreaElement(node) {
    return node.nodeName === 'TEXTAREA';
}
/**
 * Calculate the expected ARIA accessible name for given DOM Node. Given DOM Node may be either the
 * "Root node" passed to `_computeAriaAccessibleName` or "Current node" as result of recursion.
 *
 * @return the accessible name of argument DOM Node
 *
 * @param currentNode node to determine accessible name of
 * @param isDirectlyReferenced true if `currentNode` is the root node to calculate ARIA accessible
 * name of. False if it is a result of recursion.
 */
function _computeAriaAccessibleNameInternal(currentNode, isDirectlyReferenced) {
    // NOTE: this differs from accname-1.2 specification.
    //  - Does not implement Step 1. of accname-1.2: '''If `currentNode`'s role prohibits naming,
    //    return the empty string ("")'''.
    //  - Does not implement Step 2.A. of accname-1.2: '''if current node is hidden and not directly
    //    referenced by aria-labelledby... return the empty string.'''
    // acc-name-1.2 Step 2.B.: aria-labelledby
    if (ssrSafeIsElement(currentNode) && isDirectlyReferenced) {
        const labelledbyIds = currentNode.getAttribute?.('aria-labelledby')?.split(/\s+/g) || [];
        const validIdRefs = labelledbyIds.reduce((validIds, id) => {
            const elem = document.getElementById(id);
            if (elem) {
                validIds.push(elem);
            }
            return validIds;
        }, []);
        if (validIdRefs.length) {
            return validIdRefs
                .map(idRef => {
                return _computeAriaAccessibleNameInternal(idRef, false);
            })
                .join(' ');
        }
    }
    // acc-name-1.2 Step 2.C.: aria-label
    if (ssrSafeIsElement(currentNode)) {
        const ariaLabel = currentNode.getAttribute('aria-label')?.trim();
        if (ariaLabel) {
            return ariaLabel;
        }
    }
    // acc-name-1.2 Step 2.D. attribute or element that defines a text alternative
    //
    // NOTE: this differs from accname-1.2 specification.
    // Only implements Step 2.D. for `<label>`,`<input/>`, and `<textarea/>` element. Does not
    // implement other elements that have an attribute or element that defines a text alternative.
    if (ssrSafeIsHTMLInputElement(currentNode) || ssrSafeIsHTMLTextAreaElement(currentNode)) {
        // use label with a `for` attribute referencing the current node
        if (currentNode.labels?.length) {
            return Array.from(currentNode.labels)
                .map(x => _computeAriaAccessibleNameInternal(x, false))
                .join(' ');
        }
        // use placeholder if available
        const placeholder = currentNode.getAttribute('placeholder')?.trim();
        if (placeholder) {
            return placeholder;
        }
        // use title if available
        const title = currentNode.getAttribute('title')?.trim();
        if (title) {
            return title;
        }
    }
    // NOTE: this differs from accname-1.2 specification.
    //  - does not implement acc-name-1.2 Step 2.E.: '''if the current node is a control embedded
    //     within the label... then include the embedded control as part of the text alternative in
    //     the following manner...'''. Step 2E applies to embedded controls such as textbox, listbox,
    //     range, etc.
    //  - does not implement acc-name-1.2 step 2.F.: check that '''role allows name from content''',
    //    which applies to `currentNode` and its children.
    //  - does not implement acc-name-1.2 Step 2.F.ii.: '''Check for CSS generated textual content'''
    //    (e.g. :before and :after).
    //  - does not implement acc-name-1.2 Step 2.I.: '''if the current node has a Tooltip attribute,
    //    return its value'''
    // Return text content with whitespace collapsed into a single space character. Accomplish
    // acc-name-1.2 steps 2F, 2G, and 2H.
    return (currentNode.textContent || '').replace(/\s+/g, ' ').trim();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJpYS1hY2Nlc3NpYmxlLW5hbWUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9kYXRldGltZS1waWNrZXIvc3JjL2xpYi9hcmlhLWFjY2Vzc2libGUtbmFtZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxtR0FBbUc7QUFDbkcsK0ZBQStGO0FBQy9GLHlGQUF5RjtBQUN6RixFQUFFO0FBQ0YsMEZBQTBGO0FBQzFGLGFBQWE7QUFDYixFQUFFO0FBQ0Ysa0NBQWtDO0FBQ2xDLFVBQVU7QUFDViw4Q0FBOEM7QUFDOUMsZ0RBQWdEO0FBQ2hELDRDQUE0QztBQUM1QyxVQUFVO0FBQ1Ysc0VBQXNFO0FBQ3RFLDRCQUE0QjtBQUM1QixVQUFVO0FBQ1Ysc0NBQXNDO0FBQ3RDLGdEQUFnRDtBQUNoRCxtQ0FBbUM7QUFDbkMsVUFBVTtBQUNWLHlFQUF5RTtBQUN6RSwyREFBMkQ7QUFDM0QsbUJBQW1CO0FBQ25CLFVBQVU7QUFDViw0Q0FBNEM7QUFDNUMsc0VBQXNFO0FBQ3RFLG1DQUFtQztBQUNuQyxVQUFVO0FBRVY7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FtQkc7QUFDSCxNQUFNLFVBQVUsMEJBQTBCLENBQ3hDLE9BQStDO0lBRS9DLE9BQU8sa0NBQWtDLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQzNELENBQUM7QUFFRDs7O0dBR0c7QUFDSCxTQUFTLGdCQUFnQixDQUFDLElBQVU7SUFDbEMsT0FBTyxJQUFJLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxZQUFZLENBQUM7QUFDN0MsQ0FBQztBQUVEOzs7R0FHRztBQUNILFNBQVMseUJBQXlCLENBQUMsSUFBVTtJQUMzQyxPQUFPLElBQUksQ0FBQyxRQUFRLEtBQUssT0FBTyxDQUFDO0FBQ25DLENBQUM7QUFFRDs7O0dBR0c7QUFDSCxTQUFTLDRCQUE0QixDQUFDLElBQVU7SUFDOUMsT0FBTyxJQUFJLENBQUMsUUFBUSxLQUFLLFVBQVUsQ0FB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SUFBSSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ3JFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuXHJcbi8vIFRoaXMgZmlsZSBjb250YWlucyB0aGUgYF9jb21wdXRlQXJpYUFjY2Vzc2libGVOYW1lYCBmdW5jdGlvbiwgd2hpY2ggY29tcHV0ZXMgd2hhdCB0aGUgKmV4cGVjdGVkKlxyXG4vLyBBUklBIGFjY2Vzc2libGUgbmFtZSB3b3VsZCBiZSBmb3IgYSBnaXZlbiBlbGVtZW50LiBJbXBsZW1lbnRzIGEgc3Vic2V0IG9mIEFSSUEgc3BlY2lmaWNhdGlvblxyXG4vLyBbQWNjZXNzaWJsZSBOYW1lIGFuZCBEZXNjcmlwdGlvbiBDb21wdXRhdGlvbiAxLjJdKGh0dHBzOi8vd3d3LnczLm9yZy9UUi9hY2NuYW1lLTEuMi8pLlxyXG4vL1xyXG4vLyBTcGVjaWZpY2F0aW9uIGFjY25hbWUtMS4yIGNhbiBiZSBzdW1tYXJpemVkIGJ5IHJldHVybmluZyB0aGUgcmVzdWx0IG9mIHRoZSBmaXJzdCBtZXRob2RcclxuLy8gYXZhaWxhYmxlLlxyXG4vL1xyXG4vLyAgMS4gYGFyaWEtbGFiZWxsZWRieWAgYXR0cmlidXRlXHJcbi8vICAgICBgYGBcclxuLy8gICAgICAgPCEtLSBleGFtcGxlIHVzaW5nIGFyaWEtbGFiZWxsZWRieS0tPlxyXG4vLyAgICAgICA8bGFiZWwgaWQ9J2xhYmVsLWlkJz5TdGFydCBEYXRlPC9sYWJlbD5cclxuLy8gICAgICAgPGlucHV0IGFyaWEtbGFiZWxsZWRieT0nbGFiZWwtaWQnLz5cclxuLy8gICAgIGBgYFxyXG4vLyAgMi4gYGFyaWEtbGFiZWxgIGF0dHJpYnV0ZSAoZS5nLiBgPGlucHV0IGFyaWEtbGFiZWw9XCJEZXBhcnR1cmVcIi8+YClcclxuLy8gIDMuIExhYmVsIHdpdGggYGZvcmAvYGlkYFxyXG4vLyAgICAgYGBgXHJcbi8vICAgICAgIDwhLS0gZXhhbXBsZSB1c2luZyBmb3IvaWQgLS0+XHJcbi8vICAgICAgIDxsYWJlbCBmb3I9XCJjdXJyZW50LW5vZGVcIj5MYWJlbDwvbGFiZWw+XHJcbi8vICAgICAgIDxpbnB1dCBpZD1cImN1cnJlbnQtbm9kZVwiLz5cclxuLy8gICAgIGBgYFxyXG4vLyAgNC4gYHBsYWNlaG9sZGVyYCBhdHRyaWJ1dGUgKGUuZy4gYDxpbnB1dCBwbGFjZWhvbGRlcj1cIjA2LzAzLzE5OTBcIi8+YClcclxuLy8gIDUuIGB0aXRsZWAgYXR0cmlidXRlIChlLmcuIGA8aW5wdXQgdGl0bGU9XCJDaGVjay1JblwiLz5gKVxyXG4vLyAgNi4gdGV4dCBjb250ZW50XHJcbi8vICAgICBgYGBcclxuLy8gICAgICAgPCEtLSBleGFtcGxlIHVzaW5nIHRleHQgY29udGVudCAtLT5cclxuLy8gICAgICAgPGxhYmVsIGZvcj1cImN1cnJlbnQtbm9kZVwiPjxzcGFuPkRlcGFydHVyZTwvc3Bhbj4gRGF0ZTwvbGFiZWw+XHJcbi8vICAgICAgIDxpbnB1dCBpZD1cImN1cnJlbnQtbm9kZVwiLz5cclxuLy8gICAgIGBgYFxyXG5cclxuLyoqXHJcbiAqIENvbXB1dGVzIHRoZSAqZXhwZWN0ZWQqIEFSSUEgYWNjZXNzaWJsZSBuYW1lIGZvciBhcmd1bWVudCBlbGVtZW50IGJhc2VkIG9uIFthY2NuYW1lLTEuMlxyXG4gKiBzcGVjaWZpY2F0aW9uXShodHRwczovL3d3dy53My5vcmcvVFIvYWNjbmFtZS0xLjIvKS4gSW1wbGVtZW50cyBhIHN1YnNldCBvZiBhY2NuYW1lLTEuMixcclxuICogYW5kIHNob3VsZCBvbmx5IGJlIHVzZWQgZm9yIHRoZSBEYXRlcGlja2VyJ3Mgc3BlY2lmaWMgdXNlIGNhc2UuXHJcbiAqXHJcbiAqIEludGVuZGVkIHVzZTpcclxuICogVGhpcyBpcyBub3QgYSBnZW5lcmFsIHVzZSBpbXBsZW1lbnRhdGlvbi4gT25seSBpbXBsZW1lbnRzIHRoZSBwYXJ0cyBvZiBhY2NuYW1lLTEuMiB0aGF0IGFyZVxyXG4gKiByZXF1aXJlZCBmb3IgdGhlIERhdGVwaWNrZXIncyBzcGVjaWZpYyB1c2UgY2FzZS4gVGhpcyBmdW5jdGlvbiBpcyBub3QgaW50ZW5kZWQgZm9yIGFueSBvdGhlclxyXG4gKiB1c2UuXHJcbiAqXHJcbiAqIExpbWl0YXRpb25zOlxyXG4gKiAgLSBPbmx5IGNvdmVycyB0aGUgbmVlZHMgb2YgYG1hdFN0YXJ0RGF0ZWAgYW5kIGBtYXRFbmREYXRlYC4gRG9lcyBub3Qgc3VwcG9ydCBvdGhlciB1c2UgY2FzZXMuXHJcbiAqICAtIFNlZSBOT1RFUydzIGluIGltcGxlbWVudGF0aW9uIGZvciBzcGVjaWZpYyBkZXRhaWxzIG9uIHdoYXQgcGFydHMgb2YgdGhlIGFjY25hbWUtMS4yXHJcbiAqICBzcGVjaWZpY2F0aW9uIGFyZSBub3QgaW1wbGVtZW50ZWQuXHJcbiAqXHJcbiAqICBAcGFyYW0gZWxlbWVudCB7SFRNTElucHV0RWxlbWVudH0gbmF0aXZlICZsdDtpbnB1dC8mZ3Q7IGVsZW1lbnQgb2YgYG1hdFN0YXJ0RGF0ZWAgb3JcclxuICogIGBtYXRFbmREYXRlYCBjb21wb25lbnQuIENvcnJlc3BvbmRzIHRvIHRoZSAnUm9vdCBFbGVtZW50JyBmcm9tIGFjY25hbWUtMS4yXHJcbiAqXHJcbiAqICBAcmV0dXJuIGV4cGVjdGVkIEFSSUEgYWNjZXNzaWJsZSBuYW1lIG9mIGFyZ3VtZW50ICZsdDtpbnB1dC8mZ3Q7XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gX2NvbXB1dGVBcmlhQWNjZXNzaWJsZU5hbWUoXHJcbiAgZWxlbWVudDogSFRNTElucHV0RWxlbWVudCB8IEhUTUxUZXh0QXJlYUVsZW1lbnQsXHJcbik6IHN0cmluZyB7XHJcbiAgcmV0dXJuIF9jb21wdXRlQXJpYUFjY2Vzc2libGVOYW1lSW50ZXJuYWwoZWxlbWVudCwgdHJ1ZSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEZXRlcm1pbmUgaWYgYXJndW1lbnQgbm9kZSBpcyBhbiBFbGVtZW50IGJhc2VkIG9uIGBub2RlVHlwZWAgcHJvcGVydHkuIFRoaXMgZnVuY3Rpb24gaXMgc2FmZSB0b1xyXG4gKiB1c2Ugd2l0aCBzZXJ2ZXItc2lkZSByZW5kZXJpbmcuXHJcbiAqL1xyXG5mdW5jdGlvbiBzc3JTYWZlSXNFbGVtZW50KG5vZGU6IE5vZGUpOiBub2RlIGlzIEVsZW1lbnQge1xyXG4gIHJldHVybiBub2RlLm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERTtcclxufVxyXG5cclxuLyoqXHJcbiAqIERldGVybWluZSBpZiBhcmd1bWVudCBub2RlIGlzIGFuIEhUTUxJbnB1dEVsZW1lbnQgYmFzZWQgb24gYG5vZGVOYW1lYCBwcm9wZXJ0eS4gVGhpcyBmdW5jaXRvbiBpc1xyXG4gKiBzYWZlIHRvIHVzZSB3aXRoIHNlcnZlci1zaWRlIHJlbmRlcmluZy5cclxuICovXHJcbmZ1bmN0aW9uIHNzclNhZmVJc0hUTUxJbnB1dEVsZW1lbnQobm9kZTogTm9kZSk6IG5vZGUgaXMgSFRNTElucHV0RWxlbWVudCB7XHJcbiAgcmV0dXJuIG5vZGUubm9kZU5hbWUgPT09ICdJTlBVVCc7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEZXRlcm1pbmUgaWYgYXJndW1lbnQgbm9kZSBpcyBhbiBIVE1MVGV4dEFyZWFFbGVtZW50IGJhc2VkIG9uIGBub2RlTmFtZWAgcHJvcGVydHkuIFRoaXNcclxuICogZnVuY2l0b24gaXMgc2FmZSB0byB1c2Ugd2l0aCBzZXJ2ZXItc2lkZSByZW5kZXJpbmcuXHJcbiAqL1xyXG5mdW5jdGlvbiBzc3JTYWZlSXNIVE1MVGV4dEFyZWFFbGVtZW50KG5vZGU6IE5vZGUpOiBub2RlIGlzIEhUTUxUZXh0QXJlYUVsZW1lbnQge1xyXG4gIHJldHVybiBub2RlLm5vZGVOYW1lID09PSAnVEVYVEFSRUEnO1xyXG59XHJcblxyXG4vKipcclxuICogQ2FsY3VsYXRlIHRoZSBleHBlY3RlZCBBUklBIGFjY2Vzc2libGUgbmFtZSBmb3IgZ2l2ZW4gRE9NIE5vZGUuIEdpdmVuIERPTSBOb2RlIG1heSBiZSBlaXRoZXIgdGhlXHJcbiAqIFwiUm9vdCBub2RlXCIgcGFzc2VkIHRvIGBfY29tcHV0ZUFyaWFBY2Nlc3NpYmxlTmFtZWAgb3IgXCJDdXJyZW50IG5vZGVcIiBhcyByZXN1bHQgb2YgcmVjdXJzaW9uLlxyXG4gKlxyXG4gKiBAcmV0dXJuIHRoZSBhY2Nlc3NpYmxlIG5hbWUgb2YgYXJndW1lbnQgRE9NIE5vZGVcclxuICpcclxuICogQHBhcmFtIGN1cnJlbnROb2RlIG5vZGUgdG8gZGV0ZXJtaW5lIGFjY2Vzc2libGUgbmFtZSBvZlxyXG4gKiBAcGFyYW0gaXNEaXJlY3RseVJlZmVyZW5jZWQgdHJ1ZSBpZiBgY3VycmVudE5vZGVgIGlzIHRoZSByb290IG5vZGUgdG8gY2FsY3VsYXRlIEFSSUEgYWNjZXNzaWJsZVxyXG4gKiBuYW1lIG9mLiBGYWxzZSBpZiBpdCBpcyBhIHJlc3VsdCBvZiByZWN1cnNpb24uXHJcbiAqL1xyXG5mdW5jdGlvbiBfY29tcHV0ZUFyaWFBY2Nlc3NpYmxlTmFtZUludGVybmFsKFxyXG4gIGN1cnJlbnROb2RlOiBOb2RlLFxyXG4gIGlzRGlyZWN0bHlSZWZlcmVuY2VkOiBib29sZWFuLFxyXG4pOiBzdHJpbmcge1xyXG4gIC8vIE5PVEU6IHRoaXMgZGlmZmVycyBmcm9tIGFjY25hbWUtMS4yIHNwZWNpZmljYXRpb24uXHJcbiAgLy8gIC0gRG9lcyBub3QgaW1wbGVtZW50IFN0ZXAgMS4gb2YgYWNjbmFtZS0xLjI6ICcnJ0lmIGBjdXJyZW50Tm9kZWAncyByb2xlIHByb2hpYml0cyBuYW1pbmcsXHJcbiAgLy8gICAgcmV0dXJuIHRoZSBlbXB0eSBzdHJpbmcgKFwiXCIpJycnLlxyXG4gIC8vICAtIERvZXMgbm90IGltcGxlbWVudCBTdGVwIDIuQS4gb2YgYWNjbmFtZS0xLjI6ICcnJ2lmIGN1cnJlbnQgbm9kZSBpcyBoaWRkZW4gYW5kIG5vdCBkaXJlY3RseVxyXG4gIC8vICAgIHJlZmVyZW5jZWQgYnkgYXJpYS1sYWJlbGxlZGJ5Li4uIHJldHVybiB0aGUgZW1wdHkgc3RyaW5nLicnJ1xyXG5cclxuICAvLyBhY2MtbmFtZS0xLjIgU3RlcCAyLkIuOiBhcmlhLWxhYmVsbGVkYnlcclxuICBpZiAoc3NyU2FmZUlzRWxlbWVudChjdXJyZW50Tm9kZSkgJiYgaXNEaXJlY3RseVJlZmVyZW5jZWQpIHtcclxuICAgIGNvbnN0IGxhYmVsbGVkYnlJZHM6IHN0cmluZ1tdID1cclxuICAgICAgY3VycmVudE5vZGUuZ2V0QXR0cmlidXRlPy4oJ2FyaWEtbGFiZWxsZWRieScpPy5zcGxpdCgvXFxzKy9nKSB8fCBbXTtcclxuICAgIGNvbnN0IHZhbGlkSWRSZWZzOiBIVE1MRWxlbWVudFtdID0gbGFiZWxsZWRieUlkcy5yZWR1Y2UoKHZhbGlkSWRzLCBpZCkgPT4ge1xyXG4gICAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xyXG4gICAgICBpZiAoZWxlbSkge1xyXG4gICAgICAgIHZhbGlkSWRzLnB1c2goZWxlbSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHZhbGlkSWRzO1xyXG4gICAgfSwgW10gYXMgSFRNTEVsZW1lbnRbXSk7XHJcblxyXG4gICAgaWYgKHZhbGlkSWRSZWZzLmxlbmd0aCkge1xyXG4gICAgICByZXR1cm4gdmFsaWRJZFJlZnNcclxuICAgICAgICAubWFwKGlkUmVmID0+IHtcclxuICAgICAgICAgIHJldHVybiBfY29tcHV0ZUFyaWFBY2Nlc3NpYmxlTmFtZUludGVybmFsKGlkUmVmLCBmYWxzZSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuam9pbignICcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gYWNjLW5hbWUtMS4yIFN0ZXAgMi5DLjogYXJpYS1sYWJlbFxyXG4gIGlmIChzc3JTYWZlSXNFbGVtZW50KGN1cnJlbnROb2RlKSkge1xyXG4gICAgY29uc3QgYXJpYUxhYmVsID0gY3VycmVudE5vZGUuZ2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJyk/LnRyaW0oKTtcclxuXHJcbiAgICBpZiAoYXJpYUxhYmVsKSB7XHJcbiAgICAgIHJldHVybiBhcmlhTGFiZWw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBhY2MtbmFtZS0xLjIgU3RlcCAyLkQuIGF0dHJpYnV0ZSBvciBlbGVtZW50IHRoYXQgZGVmaW5lcyBhIHRleHQgYWx0ZXJuYXRpdmVcclxuICAvL1xyXG4gIC8vIE5PVEU6IHRoaXMgZGlmZmVycyBmcm9tIGFjY25hbWUtMS4yIHNwZWNpZmljYXRpb24uXHJcbiAgLy8gT25seSBpbXBsZW1lbnRzIFN0ZXAgMi5ELiBmb3IgYDxsYWJlbD5gLGA8aW5wdXQvPmAsIGFuZCBgPHRleHRhcmVhLz5gIGVsZW1lbnQuIERvZXMgbm90XHJcbiAgLy8gaW1wbGVtZW50IG90aGVyIGVsZW1lbnRzIHRoYXQgaGF2ZSBhbiBhdHRyaWJ1dGUgb3IgZWxlbWVudCB0aGF0IGRlZmluZXMgYSB0ZXh0IGFsdGVybmF0aXZlLlxyXG4gIGlmIChzc3JTYWZlSXNIVE1MSW5wdXRFbGVtZW50KGN1cnJlbnROb2RlKSB8fCBzc3JTYWZlSXNIVE1MVGV4dEFyZWFFbGVtZW50KGN1cnJlbnROb2RlKSkge1xyXG4gICAgLy8gdXNlIGxhYmVsIHdpdGggYSBgZm9yYCBhdHRyaWJ1dGUgcmVmZXJlbmNpbmcgdGhlIGN1cnJlbnQgbm9kZVxyXG4gICAgaWYgKGN1cnJlbnROb2RlLmxhYmVscz8ubGVuZ3RoKSB7XHJcbiAgICAgIHJldHVybiBBcnJheS5mcm9tKGN1cnJlbnROb2RlLmxhYmVscylcclxuICAgICAgICAubWFwKHggPT4gX2NvbXB1dGVBcmlhQWNjZXNzaWJsZU5hbWVJbnRlcm5hbCh4LCBmYWxzZSkpXHJcbiAgICAgICAgLmpvaW4oJyAnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyB1c2UgcGxhY2Vob2xkZXIgaWYgYXZhaWxhYmxlXHJcbiAgICBjb25zdCBwbGFjZWhvbGRlciA9IGN1cnJlbnROb2RlLmdldEF0dHJpYnV0ZSgncGxhY2Vob2xkZXInKT8udHJpbSgpO1xyXG4gICAgaWYgKHBsYWNlaG9sZGVyKSB7XHJcbiAgICAgIHJldHVybiBwbGFjZWhvbGRlcjtcclxuICAgIH1cclxuXHJcbiAgICAvLyB1c2UgdGl0bGUgaWYgYXZhaWxhYmxlXHJcbiAgICBjb25zdCB0aXRsZSA9IGN1cnJlbnROb2RlLmdldEF0dHJpYnV0ZSgndGl0bGUnKT8udHJpbSgpO1xyXG4gICAgaWYgKHRpdGxlKSB7XHJcbiAgICAgIHJldHVybiB0aXRsZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIE5PVEU6IHRoaXMgZGlmZmVycyBmcm9tIGFjY25hbWUtMS4yIHNwZWNpZmljYXRpb24uXHJcbiAgLy8gIC0gZG9lcyBub3QgaW1wbGVtZW50IGFjYy1uYW1lLTEuMiBTdGVwIDIuRS46ICcnJ2lmIHRoZSBjdXJyZW50IG5vZGUgaXMgYSBjb250cm9sIGVtYmVkZGVkXHJcbiAgLy8gICAgIHdpdGhpbiB0aGUgbGFiZWwuLi4gdGhlbiBpbmNsdWRlIHRoZSBlbWJlZGRlZCBjb250cm9sIGFzIHBhcnQgb2YgdGhlIHRleHQgYWx0ZXJuYXRpdmUgaW5cclxuICAvLyAgICAgdGhlIGZvbGxvd2luZyBtYW5uZXIuLi4nJycuIFN0ZXAgMkUgYXBwbGllcyB0byBlbWJlZGRlZCBjb250cm9scyBzdWNoIGFzIHRleHRib3gsIGxpc3Rib3gsXHJcbiAgLy8gICAgIHJhbmdlLCBldGMuXHJcbiAgLy8gIC0gZG9lcyBub3QgaW1wbGVtZW50IGFjYy1uYW1lLTEuMiBzdGVwIDIuRi46IGNoZWNrIHRoYXQgJycncm9sZSBhbGxvd3MgbmFtZSBmcm9tIGNvbnRlbnQnJycsXHJcbiAgLy8gICAgd2hpY2ggYXBwbGllcyB0byBgY3VycmVudE5vZGVgIGFuZCBpdHMgY2hpbGRyZW4uXHJcbiAgLy8gIC0gZG9lcyBub3QgaW1wbGVtZW50IGFjYy1uYW1lLTEuMiBTdGVwIDIuRi5paS46ICcnJ0NoZWNrIGZvciBDU1MgZ2VuZXJhdGVkIHRleHR1YWwgY29udGVudCcnJ1xyXG4gIC8vICAgIChlLmcuIDpiZWZvcmUgYW5kIDphZnRlcikuXHJcbiAgLy8gIC0gZG9lcyBub3QgaW1wbGVtZW50IGFjYy1uYW1lLTEuMiBTdGVwIDIuSS46ICcnJ2lmIHRoZSBjdXJyZW50IG5vZGUgaGFzIGEgVG9vbHRpcCBhdHRyaWJ1dGUsXHJcbiAgLy8gICAgcmV0dXJuIGl0cyB2YWx1ZScnJ1xyXG5cclxuICAvLyBSZXR1cm4gdGV4dCBjb250ZW50IHdpdGggd2hpdGVzcGFjZSBjb2xsYXBzZWQgaW50byBhIHNpbmdsZSBzcGFjZSBjaGFyYWN0ZXIuIEFjY29tcGxpc2hcclxuICAvLyBhY2MtbmFtZS0xLjIgc3RlcHMgMkYsIDJHLCBhbmQgMkguXHJcbiAgcmV0dXJuIChjdXJyZW50Tm9kZS50ZXh0Q29udGVudCB8fCAnJykucmVwbGFjZSgvXFxzKy9nLCAnICcpLnRyaW0oKTtcclxufVxyXG4iXX0=